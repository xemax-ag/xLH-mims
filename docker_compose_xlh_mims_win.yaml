name: xlh_mims
services:
  xlh_mims_python_jupyterlab:
    image: xemaxag/xlh_mims_python:latest
    container_name: xlh_mims_python_jupyterlab
    build: .
    ports:
      - 8888:8888
    expose:
      - 8888
    environment:
      MODE: "jupyterlab"
    volumes:
      - ../xLH-mims-data/python:/app/notebooks/src/local
      - ../xLH-mims-data/config:/app/config
    restart: no
# docker exec -it xlh_mims_python_jupyterlab bash

  xlh_mims_python_api:
    image: xemaxag/xlh_mims_python:latest
    container_name: xlh_mims_python_api
    build: .
    ports:
      - 8099:8099
    expose:
      - 8099
    environment:
      MODE: "api"
    volumes:
      - ../xLH-mims-data/config:/app/config
    restart: no
# docker exec -it xlh_mims_python_api bash

  xlh_mims_open_webui:
    image: ghcr.io/open-webui/open-webui:latest  # https://github.com/open-webui/open-webui
    container_name: xlh_mims_open_webui
    ports:
      - 8080:8080
    expose:
      - 8080
    volumes:
      - ../xLH-mims-data/open_webui:/app/backend/data
    environment:
      #OPENAI_API_KEY: "OPENAI_API_KEY"
      #PERPLEXITY_API_KEY: "PERPLEXITY_API_KEY"
      #ENABLE_ENFORCE_PASSWORD_POLICY: "true"
      ENV: "dev"
    restart: no

  xlh_mims_n8n:
    image: docker.n8n.io/n8nio/n8n  # https://hub.docker.com/r/n8nio/n8n
    container_name: xlh_mims_n8n
    ports:
      - 5678:5678
    expose:
      - 5678
    environment:
      GENERIC_TIMEZONE: "Europe/Berlin"
      TZ: "Europe/Berlin"
      N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS: "true"
      N8N_RUNNERS_ENABLED: "true"
    volumes:
      - ../xLH-mims-data/n8n:/home/node/.n8n
    restart: no

  xlh_mims_postgres:
    image: postgres:18.2  # https://hub.docker.com/_/postgres
    container_name: xlh_mims_postgres
    build: .
    ports:
      - 5432:5432
    environment:
      - "POSTGRES_USER=postgres"
      - "POSTGRES_PASSWORD=postgres"
    volumes:
      - ../xLH-mims-data/postgres:/var/lib/postgresql
    restart: no

#  xlh_mims_mysql:
#    image: mysql:latest
#    container_name: dev_mysql
#    environment:
#      - "MYSQL_ROOT_PASSWORD=root"
#    ports:
#      - "3307:3306"
#    volumes:
#      - ../xLH-mims-data/mysql:/var/lib/mysql
#    restart: "no"

  xlh_mims_mariadb:
    image: mariadb:latest
    container_name: dev_mariadb
    environment:
      - "MYSQL_ROOT_PASSWORD=root"
    ports:
      - "3306:3306"
    volumes:
      - ../xLH-mims-data/mariadb:/var/lib/mysql
    restart: "no"

  xlh_mims_redis:
    image: redis/redis-stack:7.4.0-v8  # https://hub.docker.com/r/redis/redis-stack
    container_name: xlh_mims_redis
    build: .
    ports:
      - 6379:6379
      - 8001:8001
    expose:
      - 6379
    volumes:
      - ../xLH-mims-data/redis:/data
    restart: no

#  xlh_mims_rabbitmq:
#    image: rabbitmq:management  # https://hub.docker.com/_/rabbitmq
#    container_name: xlh_mims_rabbitmq
#    ports:
#      - 15672:15672
#      - 5672:5672
#    expose:
#      - 5672
#    volumes:
#      - ../xLH-mims-data/rabbitmq:/var/lib/rabbitmq
#    restart: no

  xlh_mims_chromadb:
    image: chromadb/chroma  # https://hub.docker.com/r/chromadb/chroma
    container_name: xlh_mims_chromadb
    build: .
    ports:
      - 8000:8000
    expose:
      - 8000
    volumes:
      - ../xLH-mims-data/chromadb:/data
    restart: no

#  xlh_mims_qdrant:
#    image: qdrant/qdrant:latest  # https://hub.docker.com/r/qdrant/qdrant
#    container_name: xlh_mims_qdrant
#    ports:
#      - 6333:6333
#      - 6334:6334
#      - 6335:6335
#    expose:
#      - 6333
#      - 6334
#      - 6335
#    volumes:
#      - ../xLH-mims-data/qdrant:/qdrant/storage
#    restart: no

  xlh_mims_node_red:
    image: nodered/node-red:latest
    container_name: xlh_mims_node_red
    environment:
      TZ: "Europe/Berlin"
    ports:
      - 1880:1880
    expose:
      - 1880
    volumes:
      - ../xLH-mims-data/node_red:/data
    restart: no

#  xlh_mims_webtop:
#    image: lscr.io/linuxserver/webtop:ubuntu-kde
#    container_name: xlh_mims_webtop
#    #https://github.com/linuxserver/proot-apps?tab=readme-ov-file#supported-apps
#    environment:
#      - PUID=1000
#      - PGID=1000
#      - TZ=Europe/Germany
#    volumes:
#      - ../xLH-mims-data/webtop:/config
#    ports:
#      - 3000:3000
#      - 3001:3001
#    shm_size: "2gb"
#    restart: no
# https://github.com/linuxserver/proot-apps?tab=readme-ov-file#supported-apps
# proot-apps install gui
# /config/.local/bin/proot-apps install torbrowser
#pip install uv && \
#/config/.local/bin/proot-apps install libreoffice && \
#/config/.local/bin/proot-apps install firefox && \
#/config/.local/bin/proot-apps install filezilla && \
#/config/.local/bin/proot-apps install pycharm

  xlh_mims_mosquitto:
    image: eclipse-mosquitto:latest
    container_name: xlh_mims_mosquitto
    ports:
      - 1883:1883    # MQTT
      # - 8883:8883    # MQTTS (secure)
      # - 9001:9001    # WebSockets
#    volumes:
#      - ../xLH-mims-data/mosquitto/config:/mosquitto/config
#      - ../xLH-mims-data/mosquitto/data:/mosquitto/data
#      - ../xLH-mims-data/mosquitto/log:/mosquitto/log
    restart: no

#  xlh_mims_moodle:
#    image: ellakcy/moodle:mysql_maria_apache_404_php8.3  # https://hub.docker.com/r/ellakcy/moodle
#    container_name: xlh_mims_moodle
#    ports:
#      - 8081:80
#    expose:
#      - 80
#    environment:
#      MOODLE_DB_HOST: "xlh_mims_moodle_db"
#      MOODLE_URL: "http://localhost:8081"
#      MOODLE_DB_TYPE: "mariadb"
#      MOODLE_DB_PASSWORD: "admin"
#      MOODLE_DB_USER: "admin"
#      MOODLE_DB_NAME: "moodle"
#      MOODLE_DB_PORT: 3306
#      MOODLE_ADMIN: "admin"
#      MOODLE_ADMIN_PASSWORD: "admin"
#      MOODLE_ADMIN_EMAIL: "admin@example.com"
#    depends_on:
#      - xlh_mims_moodle_db
#    volumes:
#      - ../xLH-mims-data/moodle/data:/var/moodledata
#      - ../xLH-mims-data/moodle/html:/var/www/html
#    restart: no

#  xlh_mims_moodle_db:
#    image: mariadb:10.6  # https://hub.docker.com/_/mariadb
#    container_name: xlh_mims_moodle_db
#    ports:
#      - 3306:3306
#    expose:
#      - 3306
#    environment:
#      MYSQL_DATABASE: "moodle"
#      MYSQL_RANDOM_ROOT_PASSWORD: "yes"
#      MYSQL_ONETIME_PASSWORD: "yes"
#      MYSQL_USER: "admin"
#      MYSQL_PASSWORD: "admin"
#    volumes:
#      - ../xLH-mims-data/moodle/db:/var/lib/mysql:Z
#    restart: no

#  xlh_mims_mariadb:
#    image: mariadb:latest  # https://hub.docker.com/_/mariadb
#    container_name: xlh_mims_mariadb
#    ports:
#      - 3306:3306
#    expose:
#      - 3306
#    environment:
#      MARIADB_ROOT_PASSWORD: "root"
#    volumes:
#      - ../xLH-mims-data/mariadb:/var/lib/mysql:Z
#    restart: no